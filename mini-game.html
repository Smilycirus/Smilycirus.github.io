<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tiberium Clicker</title>
<style>
:root {
  --bg: #07080a;
  --panel: #101712;
  --panel-2: #0d140f;
  --text: #dff6df;
  --muted: #9fb39f;
  --accent: #7CFF7C;
  --border: #223527;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  color: var(--text);
  background: radial-gradient(circle at top, #12151a 0%, var(--bg) 60%);
}

a { color: inherit; }

.wrap {
  width: min(100% - 2rem, 1100px);
  margin: 0 auto;
  padding: 1rem 0 2.2rem;
}

.top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.back-link {
  text-decoration: none;
  color: #b8d8b8;
  border: 1px solid #38553f;
  border-radius: 8px;
  padding: 0.45rem 0.7rem;
  font-size: 0.92rem;
}

h1 {
  margin: 0;
  font-size: clamp(1.6rem, 4vw, 2.3rem);
  color: var(--accent);
}

.panel {
  background: linear-gradient(170deg, var(--panel), var(--panel-2));
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 1rem;
  box-shadow: 0 10px 30px rgba(0,0,0,0.28);
}

.howto-modal {
  position: fixed;
  inset: 0;
  z-index: 40;
  background: rgba(4, 8, 5, 0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.howto-panel {
  width: min(100%, 640px);
}

.howto-title {
  margin: 0 0 0.55rem;
  color: var(--accent);
}

.howto-modal p,
.howto-modal li {
  color: #cce7cc;
}

.howto-modal ul {
  margin: 0.65rem 0 1rem;
  padding-left: 1.2rem;
}

.howto-close {
  min-width: 180px;
}

.hidden {
  display: none;
}

.auth-panel { margin-bottom: 1rem; }
.auth-title {
  margin: 0 0 0.35rem;
  color: var(--accent);
  font-size: 1.05rem;
}
.auth-status {
  margin: 0 0 0.65rem;
  color: var(--muted);
  font-size: 0.9rem;
}
.auth-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.55rem;
}
.auth-row input {
  background: #0a110c;
  color: var(--text);
  border: 1px solid #2b4631;
  border-radius: 10px;
  padding: 0.62rem 0.72rem;
  min-width: 200px;
}
.auth-note {
  margin: 0.6rem 0 0;
  color: var(--muted);
  font-size: 0.82rem;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 0.7rem;
  margin-bottom: 1rem;
}

.stat {
  background: #0a110c;
  border: 1px solid #1d3023;
  border-radius: 10px;
  padding: 0.75rem;
}

.stat-label {
  font-size: 0.8rem;
  color: var(--muted);
  margin-bottom: 0.2rem;
}

.stat-value {
  font-size: 1.2rem;
  font-weight: 700;
}

.actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.7rem;
  margin-bottom: 1rem;
}

button {
  margin: 0;
  padding: 0.66rem 0.92rem;
  border-radius: 10px;
  border: 1px solid #2f4a35;
  background: linear-gradient(180deg, #142018, #0f1612);
  color: #e0f5e0;
  cursor: pointer;
  transition: transform 0.15s ease, border-color 0.15s ease;
  font-weight: 600;
}

button:hover {
  transform: translateY(-1px);
  border-color: #4d8c58;
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  border-color: #2f4a35;
}

.primary {
  border-color: #4f915a;
  background: linear-gradient(120deg, #2f8e42, #246f34);
}

.section-title {
  margin: 0 0 0.65rem;
  color: var(--accent);
  font-size: 1.05rem;
}

.content-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 0.9rem;
}

.list {
  display: flex;
  flex-direction: column;
  gap: 0.55rem;
}

.row-item {
  background: #0a110c;
  border: 1px solid #1d3023;
  border-radius: 10px;
  padding: 0.65rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.4rem;
  flex-wrap: wrap;
}

.row-item span { color: #d0e8d0; }

.lock-note {
  display: block;
  margin-top: 0.25rem;
  font-size: 0.78rem;
  color: #f0c68f;
}

.achievement-earned {
  border-color: #226f58;
  background: #0b1715;
  color: #89f5db;
}

.footer-note {
  margin-top: 1rem;
  color: var(--muted);
  font-size: 0.9rem;
}

@media (max-width: 900px) {
  .content-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <a class="back-link" href="index.html">← Back to Home</a>
      <h1>Tiberium Clicker</h1>
    </div>

    <main class="panel">
      <section class="panel auth-panel" aria-label="Account controls">
        <h2 class="auth-title">Account (Firebase)</h2>
        <p class="auth-status" id="authStatus">Not logged in</p>
        <div class="auth-row">
          <input id="email" type="email" autocomplete="username" placeholder="Email" aria-label="Email">
          <input id="password" type="password" autocomplete="current-password" placeholder="Password" aria-label="Password">
          <button onclick="createAccount()">Create Account</button>
          <button onclick="login()">Login</button>
          <button onclick="logout()">Logout</button>
        </div>
        <p class="auth-note">Account and save data are stored in Firebase. You must login to play/save.</p>
      </section>

      <section class="stats-grid" aria-label="Game stats">
        <div class="stat"><div class="stat-label">Tiberium</div><div class="stat-value" id="tiberium">0</div></div>
        <div class="stat"><div class="stat-label">TPS</div><div class="stat-value" id="tps">0</div></div>
        <div class="stat"><div class="stat-label">Prestige Crystals</div><div class="stat-value" id="prestige">0</div></div>
        <div class="stat"><div class="stat-label">Click Power</div><div class="stat-value" id="clickPower">1</div></div>
        <div class="stat"><div class="stat-label">Total Clicks</div><div class="stat-value" id="totalClicks">0</div></div>
        <div class="stat"><div class="stat-label">Total Earned</div><div class="stat-value" id="totalEarned">0</div></div>
      </section>

      <section class="actions">
        <button class="primary" onclick="clickTiberium()">Harvest (+<span id="harvestPreview">1</span>)</button>
        <button onclick="prestigeReset()">Prestige Reset</button>
        <button onclick="hardReset()">Full Reset</button>
      </section>

      <section class="content-grid">
        <article class="panel">
          <h2 class="section-title">Buildings</h2>
          <div id="buildings" class="list"></div>
        </article>

        <article class="panel">
          <h2 class="section-title">Upgrades</h2>
          <div id="upgrades" class="list"></div>
        </article>

        <article class="panel">
          <h2 class="section-title">Achievements</h2>
          <div id="achievements" class="list"></div>
        </article>
      </section>

      <p class="footer-note">Tip: Prestige gives a permanent bonus to clicking and building production.</p>
    </main>
  </div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
import { getAnalytics } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js';
import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: 'AIzaSyDC2abQAAaQSxYxZ7g3_OKqQqlqPHCPyu4',
  authDomain: 'my-website-80cbb.firebaseapp.com',
  projectId: 'my-website-80cbb',
  storageBucket: 'my-website-80cbb.firebasestorage.app',
  messagingSenderId: '781604542143',
  appId: '1:781604542143:web:50a7bf43fe987a306a980a',
  measurementId: 'G-8BXHP342KD'
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

const numberFormatter = new Intl.NumberFormat('en-US', { maximumFractionDigits: 1 });
const LEGACY_SAVE_KEY = 'tibSave';

function createDefaultGame(prestige = 0) {
  return {
    tiberium: 0,
    totalEarned: 0,
    totalClicks: 0,
    clickPower: 1,
    prestige,
    buildings: {},
    buildingMultipliers: {},
    upgrades: {},
    achievements: {}
  };
}

function normalizeGame(rawGame) {
  const safe = rawGame && typeof rawGame === 'object' ? rawGame : {};
  return {
    tiberium: Number(safe.tiberium) || 0,
    totalEarned: Number(safe.totalEarned) || 0,
    totalClicks: Number(safe.totalClicks) || 0,
    clickPower: Number(safe.clickPower) || 1,
    prestige: Number(safe.prestige) || 0,
    buildings: safe.buildings && typeof safe.buildings === 'object' ? safe.buildings : {},
    buildingMultipliers: safe.buildingMultipliers && typeof safe.buildingMultipliers === 'object' ? safe.buildingMultipliers : {},
    upgrades: safe.upgrades && typeof safe.upgrades === 'object' ? safe.upgrades : {},
    achievements: safe.achievements && typeof safe.achievements === 'object' ? safe.achievements : {}
  };
}

let game = createDefaultGame();
let currentUid = '';
let saveTimeout = 0;

const buildingTypes = [
  { name: 'Harvester', base: 10, tps: 1 },
  { name: 'Refinery', base: 100, tps: 8 },
  { name: 'Lab', base: 1000, tps: 47 },
  { name: 'Crystal Mine', base: 10000, tps: 260 },
  { name: 'Temple Reactor', base: 70000, tps: 1450 },
  { name: 'Tiberium Rig', base: 350000, tps: 7800 }
];

const upgradeTypes = [
  { name: 'Double Click', cost: 100, type: 'click', multi: 2 },
  { name: 'Harvester Boost', cost: 500, type: 'Harvester', multi: 2 },
  { name: 'Refinery Boost', cost: 2000, type: 'Refinery', multi: 2, unlock: { building: 'Harvester', count: 10 } },
  { name: 'Lab Automation', cost: 12000, type: 'Lab', multi: 2, unlock: { building: 'Refinery', count: 5 } },
  { name: 'Crystal Compression', cost: 60000, type: 'Crystal Mine', multi: 2, unlock: { building: 'Lab', count: 6 } },
  { name: 'Temple Overclock', cost: 175000, type: 'Temple Reactor', multi: 2, unlock: { building: 'Crystal Mine', count: 4 } },
  { name: 'Global Logistics', cost: 520000, type: 'all', multi: 1.25, unlock: { building: 'Temple Reactor', count: 3 } },
  { name: 'Rig Swarm Protocol', cost: 1500000, type: 'Tiberium Rig', multi: 2, unlock: { building: 'Temple Reactor', count: 8 } } ,

];

const achievementTypes = [
  { name: 'First Click', description: 'Perform your first harvest.', condition: () => game.totalClicks >= 1, reward: { type: 'tiberium', value: 25 } },
  { name: 'Field Technician', description: 'Own 10 Harvesters.', condition: () => game.buildings.Harvester?.cunt >= 10, reward: { type: 'buildingBoost', building: 'Harvester', value: 1.25 } },
  { name: '100 Tiberium', description: 'Earn 100 total Tiberium.', condition: () => game.totalEarned >= 100, reward: { type: 'clickPower', value: 1 } },
  { name: '1000 Tiberium', description: 'Earn 1,000 total Tiberium.', condition: () => game.totalEarned >= 1000, reward: { type: 'tiberium', value: 250 } },
  { name: 'Industrial Core', description: 'Own 5 Refineries and 3 Labs.', condition: () => game.buildings.Refinery?.count >= 5 && game.buildings.Lab?.count >= 3, reward: { type: 'buildingBoost', building: 'Refinery', value: 1.2 } },
  { name: 'Crystal Engineer', description: 'Own 5 Crystal Mines.', condition: () => game.buildings['Crystal Mine']?.count >= 5, reward: { type: 'buildingBoost', building: 'Crystal Mine', value: 1.25 } },
  { name: 'Prestige Initiate', description: 'Reach 1 Prestige Crystal.', condition: () => game.prestige >= 1, reward: { type: 'clickPower', value: 3 } },
  { name: 'War Economy', description: 'Reach 1,000 TPS.', condition: () => getTotalTps() >= 1000, reward: { type: 'allBuildingBoost', value: 1.1 } },
  { name: 'Tiberium Baron', description: 'Earn 1,000,000 total Tiberium.', condition: () => game.totalEarned >= 1000000, reward: { type: 'tiberium', value: 150000 } }
];

function ensureGameModel() {
  buildingTypes.forEach((building) => {
    if (!game.buildings[building.name]) {
      game.buildings[building.name] = { count: 0, cost: building.base };
    }
    if (!game.buildingMultipliers[building.name]) {
      game.buildingMultipliers[building.name] = 1;
    }
  });

  upgradeTypes.forEach((upgrade) => {
    if (!Object.prototype.hasOwnProperty.call(game.upgrades, upgrade.name)) {
      game.upgrades[upgrade.name] = false;
    }
  });

  achievementTypes.forEach((achievement) => {
    if (!Object.prototype.hasOwnProperty.call(game.achievements, achievement.name)) {
      game.achievements[achievement.name] = false;
    }
  });
}

function wireRows() {
  buildingTypes.forEach((building) => {
    const div = document.createElement('div');
    div.id = `b-${building.name}`;
    div.className = 'row-item';
    div.innerHTML = `<span>${building.name}<br>Owned: <strong class='count'>0</strong> · Boost: <strong class='boost'>x1</strong> · Cost: <strong class='cost'>0</strong></span><button onclick="buyBuilding('${building.name}')">Buy</button>`;
    document.getElementById('buildings').appendChild(div);
  });

  upgradeTypes.forEach((upgrade) => {
    const div = document.createElement('div');
    div.id = `u-${upgrade.name}`;
    div.className = 'row-item';
    div.innerHTML = `<span>${upgrade.name} (<strong>${numberFormatter.format(upgrade.cost)}</strong>)<small class="lock-note"></small></span><button onclick="buyUpgrade('${upgrade.name}')">Buy</button>`;
    document.getElementById('upgrades').appendChild(div);
  });

  achievementTypes.forEach((achievement) => {
    const div = document.createElement('div');
    div.id = `a-${achievement.name}`;
    div.className = 'row-item';
    div.innerHTML = `<span>${achievement.name}<br><small>${achievement.description}</small></span>`;
    document.getElementById('achievements').appendChild(div);
  });
}

function getTotalTps() {
  return buildingTypes.reduce((total, building) => total + getBuildingTps(building.name), 0);
}

function describeUnlockRequirement(unlock) {
  if (!unlock) return '';
  return `Requires ${unlock.count} ${unlock.building}(s)`;
}

function upgradeUnlocked(upgrade) {
  if (!upgrade.unlock) return true;
  const owned = game.buildings[upgrade.unlock.building]?.count || 0;
  return owned >= upgrade.unlock.count;
}

function applyAchievementReward(achievement) {
  if (!achievement.reward) return;

  switch (achievement.reward.type) {
    case 'tiberium':
      game.tiberium += achievement.reward.value;
      game.totalEarned += achievement.reward.value;
      break;
    case 'clickPower':
      game.clickPower += achievement.reward.value;
      break;
    case 'buildingBoost':
      if (game.buildingMultipliers[achievement.reward.building]) {
        game.buildingMultipliers[achievement.reward.building] *= achievement.reward.value;
      }
      break;
    case 'allBuildingBoost':
      buildingTypes.forEach((building) => {
        game.buildingMultipliers[building.name] *= achievement.reward.value;
      });
      break;
    default:
      break;
  }
}

function formatNum(value) {
  return numberFormatter.format(value);
}

function getCredentials() {
  return {
    email: document.getElementById('email').value.trim(),
    password: document.getElementById('password').value
  };
}

function clearCredentials() {
  document.getElementById('password').value = '';
}

function ensureLoggedIn() {
  if (currentUid) return true;
  window.alert('Please login or create an account first.');
  return false;
}

function updateAuthStatus() {
  const status = document.getElementById('authStatus');
  const user = auth.currentUser;
  status.textContent = user
    ? `Logged in as ${user.email}. Progress saves to Firebase.`
    : 'Not logged in. Create an account or login to save progress.';
}

async function loadCloudSave(uid) {
  const saveDoc = await getDoc(doc(db, 'clickerSaves', uid));
  if (saveDoc.exists()) {
    game = normalizeGame(saveDoc.data());
  } else {
    const legacy = localStorage.getItem(LEGACY_SAVE_KEY);
    if (legacy) {
      try {
        game = normalizeGame(JSON.parse(legacy));
        localStorage.removeItem(LEGACY_SAVE_KEY);
      } catch {
        game = createDefaultGame();
      }
    } else {
      game = createDefaultGame();
    }
    await saveNow();
  }
  ensureGameModel();
  update();
}

async function saveNow() {
  if (!currentUid) return;
  await setDoc(doc(db, 'clickerSaves', currentUid), game);
}

function queueSave() {
  if (!currentUid) return;
  clearTimeout(saveTimeout);
  saveTimeout = window.setTimeout(async () => {
    await saveNow();
  }, 300);
}

window.createAccount = async function createAccount() {
  const { email, password } = getCredentials();
  if (!email || !password) {
    window.alert('Enter both email and password.');
    return;
  }

  try {
    await createUserWithEmailAndPassword(auth, email, password);
    clearCredentials();
  } catch (error) {
    window.alert(error.message || 'Could not create account.');
  }
};

window.login = async function login() {
  const { email, password } = getCredentials();
  if (!email || !password) {
    window.alert('Enter both email and password.');
    return;
  }

  try {
    await signInWithEmailAndPassword(auth, email, password);
    clearCredentials();
  } catch (error) {
    window.alert(error.message || 'Login failed.');
  }
};

window.logout = async function logout() {
  await signOut(auth);
};

window.clickTiberium = function clickTiberium() {
  if (!ensureLoggedIn()) return;

  const gain = game.clickPower * (1 + game.prestige * 0.1);
  game.tiberium += gain;
  game.totalEarned += gain;
  game.totalClicks += 1;
  update();
  queueSave();
};

window.buyBuilding = function buyBuilding(name) {
  if (!ensureLoggedIn()) return;

  const building = game.buildings[name];
  if (game.tiberium >= building.cost) {
    game.tiberium -= building.cost;
    building.count += 1;
    building.cost = Math.floor(building.cost * 1.15);
    update();
    queueSave();
  }
};

window.buyUpgrade = function buyUpgrade(name) {
  if (!ensureLoggedIn()) return;

  const upgrade = upgradeTypes.find((item) => item.name === name);
  if (upgrade && game.tiberium >= upgrade.cost && !game.upgrades[name] && upgradeUnlocked(upgrade)) {
    game.tiberium -= upgrade.cost;
    game.upgrades[name] = true;

    if (upgrade.type === 'click') {
      game.clickPower *= upgrade.multi;
    } else if (upgrade.type === 'all') {
      buildingTypes.forEach((building) => {
        game.buildingMultipliers[building.name] *= upgrade.multi;
      });
    } else {
      game.buildingMultipliers[upgrade.type] *= upgrade.multi;
    }

    update();
    queueSave();
  }
};

window.prestigeReset = function prestigeReset() {
  if (!ensureLoggedIn()) return;

  const crystals = Math.floor(game.totalEarned / 10000);
  if (crystals > 0) {
    game = createDefaultGame(game.prestige + crystals);
    ensureGameModel();
    update();
    queueSave();
  }
};

window.hardReset = function hardReset() {
  if (!ensureLoggedIn()) return;

  const confirmed = window.confirm('Reset all progress, including Prestige Crystals?');
  if (!confirmed) return;

  game = createDefaultGame();
  ensureGameModel();
  update();
  queueSave();
};

function getBuildingTps(buildingName) {
  const buildingType = buildingTypes.find((building) => building.name === buildingName);
  const buildingState = game.buildings[buildingName];
  return buildingType.tps * buildingState.count * game.buildingMultipliers[buildingName] * (1 + game.prestige * 0.1);
}

function update() {
  updateAuthStatus();
  const canPlay = Boolean(currentUid);

  document.getElementById('tiberium').textContent = formatNum(Math.floor(game.tiberium));
  document.getElementById('clickPower').textContent = formatNum(game.clickPower);
  document.getElementById('harvestPreview').textContent = formatNum(game.clickPower * (1 + game.prestige * 0.1));
  document.getElementById('totalClicks').textContent = formatNum(game.totalClicks);
  document.getElementById('totalEarned').textContent = formatNum(Math.floor(game.totalEarned));
  document.getElementById('prestige').textContent = formatNum(game.prestige);

  buildingTypes.forEach((building) => {
    const row = document.getElementById(`b-${building.name}`);
    const canAfford = game.tiberium >= game.buildings[building.name].cost;
    row.querySelector('.count').textContent = formatNum(game.buildings[building.name].count);
    row.querySelector('.boost').textContent = `x${formatNum(game.buildingMultipliers[building.name])}`;
    row.querySelector('.cost').textContent = formatNum(game.buildings[building.name].cost);
    row.querySelector('button').disabled = !canAfford || !canPlay;
  });

  const totalTPS = getTotalTps();
  document.getElementById('tps').textContent = formatNum(Math.floor(totalTPS));

  upgradeTypes.forEach((upgrade) => {
    const upgradeRow = document.getElementById(`u-${upgrade.name}`);
    if (game.upgrades[upgrade.name]) {
      upgradeRow.style.display = 'none';
    } else {
      upgradeRow.style.display = 'flex';
      const unlocked = upgradeUnlocked(upgrade);
      const lockNote = upgradeRow.querySelector('.lock-note');
      lockNote.textContent = unlocked ? '' : describeUnlockRequirement(upgrade.unlock);
      upgradeRow.querySelector('button').disabled = game.tiberium < upgrade.cost || !canPlay || !unlocked;
    }
  });

  document.querySelectorAll('.actions button').forEach((button) => {
    button.disabled = !canPlay;
  });

  achievementTypes.forEach((achievement) => {
    const achievementRow = document.getElementById(`a-${achievement.name}`);
    if (!game.achievements[achievement.name] && achievement.condition()) {
      game.achievements[achievement.name] = true;
      applyAchievementReward(achievement);
    }
    if (game.achievements[achievement.name]) {
      achievementRow.classList.add('achievement-earned');
      achievementRow.innerHTML = `<span>✔ ${achievement.name}<br><small>${achievement.description}</small></span>`;
    }
  });
}

window.closeHowToModal = function closeHowToModal() {
  document.getElementById('howtoModal').classList.add('hidden');
};

setInterval(() => {
  if (!currentUid) return;

  buildingTypes.forEach((building) => {
    const passiveGain = getBuildingTps(building.name);
    game.tiberium += passiveGain;
    game.totalEarned += passiveGain;
  });
  update();
  queueSave();
}, 1000);

wireRows();
ensureGameModel();
update();

onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUid = user.uid;
    await loadCloudSave(user.uid);
  } else {
    currentUid = '';
    game = createDefaultGame();
    ensureGameModel();
    update();
  }
});
</script>
</body>
</html>
